<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Перекур Mini App</title>
</head>
<body>
  <h2>Нажми кнопку, чтобы выйти на перекур</h2>
  <button id="smokeBtn">Хочу перекурить</button>
  <p id="status"></p>

  <script src="https://whoi0.github.io/"></script>
  <script>
    const tg = window.Telegram.WebApp;
    const status = document.getElementById('status');

    document.getElementById('smokeBtn').addEventListener('click', () => {
      if (!navigator.geolocation) {
        status.textContent = "Геолокация не поддерживается браузером.";
        return;
      }
      status.textContent = "Определяем ваше местоположение...";

      navigator.geolocation.getCurrentPosition(position => {
        const data = {
          action: "smoke_break",
          lat: position.coords.latitude,
          lon: position.coords.longitude,
          timestamp: Date.now()
        };

        tg.sendData(JSON.stringify(data));
        status.textContent = "Сигнал отправлен боту. Спасибо!";
      }, error => {
        status.textContent = "Не удалось определить местоположение.";
      });
    });
  </script>
</body>
</html>
